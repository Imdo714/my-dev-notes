# ğŸ“š Kotlin - Generic ê³µë³€, ë°˜ê³µë³€

> ğŸ’¡ê³µë³€(out)ì€ ë°˜í™˜ ì „ìš©ìœ¼ë¡œ í•˜ìœ„ íƒ€ì…ì„ ìƒìœ„ íƒ€ì…ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ë°”ê¾¸ëŠ” ê²ƒì´ê³ , ë°˜ê³µë³€(in)ì€ ì…ë ¥ ì „ìš©ìœ¼ë¡œ ìƒìœ„ íƒ€ì…ì„ í•˜ìœ„ íƒ€ì…ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ë°”ê¾¸ëŠ” ê²ƒì´ë‹¤.

## ì˜ˆì œ ì½”ë“œ
```kotlin
class Cage2<T> {
    private val animals: MutableList<T> = mutableListOf()

    fun getFirst(): T {
        return animals.first()
    }

    fun put(animal: T) {
        this.animals.add(animal)
    }

    fun moveFrom(cage: Cage2<T>) {
        this.animals.addAll(cage.animals)
    }
}
```

```kotlin
abstract class Animal(
  val name: String,
)

abstract class Fish(name: String) : Animal(name)

// ê¸ˆë¶•ì–´
class GoldFish(name: String) : Fish(name)

// ì‰ì–´
class Carp(name: String) : Fish(name)
```


## ğŸ“—í•¨ìˆ˜ë¥¼ ê³µë³€í•˜ë„ë¡ ë§Œë“¤ê¸°
- ì´ í•¨ìˆ˜ë¥¼ ê³µë³€í•˜ë„ë¡ ë§Œë“¤ë©´, í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ Cage2<Fish> ëŠ” Cage2<GoldFish> ì˜ ìƒìœ„ íƒ€ì…ì´ ë˜ê³ , ìš°ë¦¬ëŠ” ê¸ˆë¶•ì–´ Cage ë¡œë¶€í„° ê¸ˆë¶•ì–´ë¥¼ êº¼ë‚´ ë¬¼ê³ ê¸° Cageì— ë„£ì„ ìˆ˜ ìˆê²Œ ëœë‹¤.
- ë°©ë²•ì€ ê°„ë‹¨í•˜ë‹¤ í•¨ìˆ˜ì˜ ê³µë³€ì„ í¬í˜„í•˜ê¸° ìœ„í•´ì„œëŠ” í•¨ìˆ˜ì— ìˆëŠ” íƒ€ì… íŒŒë¼ë¯¸í„° ì•ì— `out`ì„ ë¶™ì´ë©´ ëœë‹¤.
- ì• ë‹¹ì´ˆ ìƒì†ê´€ê³„ê°€ ìˆë”ë¼ë„ ë‘˜ ì‚¬ì´ê°€ ì•„ë¬´ê²ƒë„ ì•„ë‹Œê²Œ ì•„ë‹ˆë¼ ì–´ë– í•œ ê´€ê²Œë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ê²ƒ ìì²´ë¥¼ `ë³€ì„±`ì„ ì£¼ë‹¤ ë¼ê³  í•œë‹¤.
- ì´ë•Œ `out`ì„ "ë³€ì„± ì–´ë…¸í…Œì´ì…˜"(variance annotation)ì´ë¼ ë¶€ë¥¸ë‹¤.
```kotlin
fun moveFrom(otherCage: Cage2<out T>) {
    this.animals.addAll(otherCage.animals)
}
```

![Image](https://github.com/user-attachments/assets/a34244f2-06d3-412b-bf5e-628ba9f0ab22)

- ì´ë ‡ê²Œ ë˜ë©´ ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ Cage2 ê°€ ê³µë³€í•˜ê²Œ ë˜ê³ 
- `out`ì„ ë¶™ì¸ ë•ë¶„ì—, `Cage2<Fish>`ê°€ `Cage2<GoldFish>`ì˜ ìƒìœ„ íƒ€ì…ìœ¼ë¡œ ê°„ì£¼ë˜ê³ , ì•„ë˜ ì½”ë“œê°€ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•  ìˆ˜ ìˆê²Œ ëœ ê²ƒì´ë‹¤.
- â€œ`Fish`íƒ€ì…ì´ê±°ë‚˜ `Fish`ì˜ í•˜ìœ„íƒ€ì…ì˜ ë™ë¬¼ì´ ë“¤ì–´ ìˆëŠ” `Cage`â€ë¼ê³  í•´ì„í•  ìˆ˜ ìˆë‹¤.

```kotlin
fun main() {
    val goldFishCage = Cage2<GoldFish>()
    goldFishCage.put(GoldFish("ê¸ˆë¶•ì–´"))
    
    val cage = Cage2<Fish>()
    cage.moveFrom(goldFishCage)

    val fish: Fish = cage.getFirst() // Fish íƒ€ì…ìœ¼ë¡œ ë°˜í™˜ëœë‹¤!
}
```

## ğŸ“˜outì˜ ì˜ë¯¸ ì‚´í´ë³´ê¸°

- ğŸš¨ì¤‘ìš”ğŸš¨ **ì´ë ‡ê²Œ `out`ë³€ì„± ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ íŒŒë¼ë¯¸í„°ëŠ” ì˜¤ì§ **"ìƒì‚°ìì˜ ì—­í• "** ë§Œ í•  ìˆ˜ ìˆë‹¤.**
- ìƒì‚°ìì˜ ì—­í• ë§Œ í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì€ ë°ì´í„°ë¥¼ êº¼ë‚´ê¸°ë§Œ(ìƒì‚° í•˜ê¸°ë§Œ) í•  ìˆ˜ ìˆë‹¤ëŠ” ëœ»ì´ë‹¤.
- ìš°ë¦¬ëŠ” `moveFrom`í•¨ìˆ˜ì˜ `otherCage` íŒŒë¼ë¯¸í„°ì— `out`ì„ ë¶™ì˜€ë‹¤. ë”°ë¼ì„œ `otherCage`ëŠ” ìƒì‚°ì ì—­í• ë§Œ, ë°ì´í„°ë¥¼ êº¼ë‚´ëŠ” ì—­í• ë§Œ í•  ìˆ˜ ìˆë‹¤.
- `Cage2` í´ë˜ìŠ¤ì˜ í•¨ìˆ˜ ì¤‘ ë°ì´í„°ë¥¼ êº¼ë‚´ëŠ” í•¨ìˆ˜ì¸ `getFirst(): T` ì™€ `getAnimals: MutableList<T>` ë§Œ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.
- ë§Œì•½ `otherCage` ì— ë°ì´í„°ë¥¼ ë„£ìœ¼ë ¤ í•œë‹¤ë©´ ì¦‰, ì†Œë¹„ì ì—­í• ì„ ì‹œí‚¤ë ¤ í•˜ë©´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.
```kotlin
fun moveFrom(otherCage: Cage2<out T>) {
    otherCage.getFirst() 
    otherCage.put(getFirst()) // ì—ëŸ¬ ë°œìƒ!
    this.animals.addAll(otherCage.animals)
}
```

## â“ì™œ outì„ ë¶™ì´ë©´ ìƒì‚°ì ì—­í• ë§Œ í• ê¹Œ? 

- ì•„ë˜ ì½”ë“œë¥¼ ë³´ë©´ `otherCage`ê°€ `Cage2<GoldFish>` ì¸ ìƒí™©ì—ì„œ `otherCage`ì— `Carp(ì‰ì–´)`ë¥¼ ë„£ìœ¼ë ¤ê³  í•˜ê²Œ ëœë‹¤.
- í•˜ì§€ë§Œ, `otherCage`ì—ëŠ” `GoldFish`ë§Œ ë“¤ì–´ê°ˆ ìˆ˜ ìˆì„ ë¿ `Carp`ë¥¼ ë„£ì„ ìˆ˜ ì—†ë‹¤. ë”°ë¼ì„œ `otherCage.put(getFirst())` ì½”ë“œë¥¼ í—ˆë½í•´ ì£¼ë©´ íƒ€ì… ì•ˆì „ì„±ì´ ê¹¨ì§€ê³  ëŸ°íƒ€ì„ ì—ëŸ¬ê°€ ë‚˜ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.
1. `Cage2<Fish>` íƒ€ì…ì´ `Carp(ì‰ì–´)`ë¥¼ `put()`í•˜ê³  íŒŒë¼ë¯¸í„°ë¡œ ê¸ˆë¶•ì–´ë¥¼ ë‹´ì•„`moveFrom`ë©”ì†Œë“œ í˜¸ì¶œ
2. `otherCage` íƒ€ì…ì€ `Cage2<out Fish>` ë¡œ ë¨
3. ì²˜ìŒì— `put()`ìœ¼ë¡œ ì‰ì–´ ë¥¼ ë‹´ì•˜ëŠ”ë° `moveFrom`í˜¸ì¶œí• ë•Œ ê¸ˆë¶•ì–´ë¥¼ ë‹´ì•„ì„œ `Carp(ì‰ì–´)`ë¥¼ `Cage2<GoldFish>`ì— ë„£ìœ¼ë ¤ê³  í•¨
4. ê·¸ë˜ì„œ íƒ€ì…ì˜ ì•ˆì „ì„± ë³´ì¥ì„ ìœ„í•´ `put()`ê°™ì€ ì†Œë¹„ë¥¼ ëª»í•˜ë„ë¡ í•¨
- ğŸš¨ì¤‘ìš”ğŸš¨ **ì •ë¦¬í•˜ìë©´, TëŠ” ì–´ë–¤ íƒ€ì…ì¸ì§€ ì •í™•íˆ ëª¨ë¥¸ë‹¤, ë‹¨ì§€ Tì˜ í•˜ìœ„ íƒ€ì…ì´ë¼ëŠ” ê²ƒë§Œ ì•ˆë‹¤.**
- ê·¸ë˜ì„œ `get()`ì€ ê°€ëŠ¥í•˜ì§€ë§Œ, `put()`ì€ ë¶ˆê°€ëŠ¥í•˜ë‹¤.

```kotlin
fun moveFrom(otherCage: Cage2<out T>) {
    otherCage.put(getFirst()) // ì—ëŸ¬ê°€ ë‚˜ì§€ë§Œ ë™ì‘í•œë‹¤ê³  ìƒê°í•˜ê¸° !
    this.animals.addAll(otherCage.animals)
}

val goldFishCage = Cage2<GoldFish>()
goldFishCage.put(GoldFish("ê¸ˆë¶•ì–´"))

val cage2 = Cage2<Fish>() // cage2ì˜ íƒ€ì…ì€ = Cage2<Fish>
cage2.put(Carp("ì‰ì–´"))
cage2.moveFrom(goldFishCage) 
```

![Image](https://github.com/user-attachments/assets/28674bcc-ec0e-49a4-8580-c79c4ba5bb6e)

## ğŸ§¾ë°˜ëŒ€ ì¼€ì´ìŠ¤ "ë°˜ê³µë³€(contra-variant)"
- ë‚´ê°€ ê°€ì§€ê³ ìˆëŠ” ë™ë¬¼ì„ otherCageì— ë„£ì–´ì£¼ëŠ” í•¨ìˆ˜(moveTo)ë¥¼ ë§Œë“¤ì

```kotlin
fun moveTo(otherCage: Cage2<T>) {
    otherCage.animals.addAll(this.animals)
}
```

- ì•„ë˜ ì½”ë“œëŠ” í˜„ì¬ ë¬´ê³µë³€ ìƒíƒœì—¬ì„œ `Type Mismatch` ì—ëŸ¬ê°€ ëœ¬ë‹¤. (ì•„ì§ ê³µë³€ ì„¤ì • ì•ˆí•´ ì¤Œ)
- ì´ë²ˆì—ëŠ” `out`ì„ ë¶™ì¸ë‹¤ê³  í•´ì„œ í•´ê²°ë˜ì§€ ì•ŠëŠ”ë‹¤. `Cage2<GoldFish>`ìë¦¬ì— `Cage2<Fish>`ê°€ ë“¤ì–´ê°€ì•¼ í•˜ê¸° ë•Œë¬¸ì´ë‹¤.
- ì‰½ê²Œ ë§í•´ (í•˜ìœ„ íƒ€ì…)**ê¸ˆë¶•ì–´ ì¼€ì´ì§€**ì—ì„œ (ìƒìœ„ íƒ€ì…)**ë¬¼ê³ ê¸° ì¼€ì´ì§€**ë¡œ ì´ë™ ê°€ëŠ¥í•˜ê²Œ í•´ì•¼ í•œë‹¤.
- ì¦‰, `Fish` ê³¼ `GoldFish`ì˜ ìƒìœ„ íƒ€ì…ì¼ ë•Œ ë°˜ëŒ€ë¡œ `Cage2<GoldFish>`ê°€ `Cage2<Fish>`ì˜ ìƒìœ„ íƒ€ì…ìœ¼ë¡œ ê°„ì£¼ë˜ì–´ì•¼ í•˜ëŠ” ê²ƒì´ë‹¤.
- ì´ë¥¼ **"ë°˜ê³µë³€(contra-variant)"** í•˜ë‹¤ê³  ë¶€ë¥¸ë‹¤.

````kotlin
val myCage = Cage2<Fish>()

val goldFishCage = Cage2<GoldFish>()
goldFishCage.put(GoldFish("ê¸ˆë¶•ì–´"))
goldFishCage.moveTo(myCage) // Type Mismatch
````
![Image](https://github.com/user-attachments/assets/6437b613-c305-448c-bd61-ceadc02ee809)

- ì´ë ‡ê²Œ `in`ë³€ì„± ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ ë§¤ê°œë³€ìˆ˜ì˜ ê²½ìš° `out`ì´ ë¶™ì—ˆì„ ë•Œì™€ ë‹¤ë¥´ê²Œ ë°ì´í„°ë¥¼ ì†Œë¹„í•˜ëŠ” í•¨ìˆ˜ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ëœë‹¤.
-  `Cage2` í´ë˜ìŠ¤ì˜ í•¨ìˆ˜ ì¤‘ ë°ì´í„°ë¥¼ ê°€ì ¸ê°€ëŠ” í•¨ìˆ˜ì¸ `put(animal: T)`ê³¼ `moveFrom(otherCage: Cage2<out T>)`ë§Œ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.
- íƒ€ì… ì•ˆì „ì„±ì„ ìœ„í•´ put()ë§Œ ê°€ëŠ¥, get()ì€ ë¶ˆê°€ëŠ¥!
```kotlin
fun moveTo(otherCage: Cage2<in T>) {
    otherCage.animals.addAll(this.animals)
}
```

## ğŸ””ìš”ì•½
| í‚¤ì›Œë“œ   | ì—­í•              | ê´€ì                | íƒ€ì… ê´€ê³„              | ì˜ˆì‹œ                 | ì„¤ëª…                  |
| ----- | -------------- | ---------------- | ------------------ | ------------------ | ------------------- |
| `out` | ìƒì‚°ì (Producer) | ë°˜í™˜(return) ì¤‘ì‹¬    | ê³µë³€(Covariant)      | `List<out T>`      | **ì¶œë ¥ë§Œ ê°€ëŠ¥**, ì…ë ¥ì€ ë¶ˆê°€ëŠ¥ |
| `in`  | ì†Œë¹„ì (Consumer) | ì…ë ¥(parameter) ì¤‘ì‹¬ | ë°˜ê³µë³€(Contravariant) | `Comparator<in T>` | **ì…ë ¥ë§Œ ê°€ëŠ¥**, ì¶œë ¥ì€ ë¶ˆê°€ëŠ¥ |

