# ğŸ“š ìŠ¤í”„ë§ - ì˜ì†ì„± ê´€ë¦¬ 

> ğŸ’¡ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ì—”í‹°í‹°ë¥¼ 1ì°¨ ìºì‹œì— ì €ì¥í•´ì„œ ë™ì¼ì„±(identity)ê³¼ ë³€ê²½ ê°ì§€ë¥¼ ë³´ì¥í•´ì¤€ë‹¤!

## ğŸ“ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë€? 

* ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸(`persistence context`)ëŠ” ì—”í‹°í‹°ë¥¼ ì˜êµ¬ ì €ì¥í•˜ëŠ” í™˜ê²½ì´ë¼ëŠ” ëœ»ì´ë‹¤.
* ì—”í‹°í‹° ë§¤ë‹ˆì €ë¡œ ì—”í‹°í‹°ë¥¼ ì €ì¥í•˜ê±°ë‚˜ ì¡°íšŒí•˜ë©´ ì—”í‹°í‹° ë§¤ë‹ˆì €ëŠ” **ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì—”í‹°í‹°ë¥¼ ë³´ê´€í•˜ê³  ê´€ë¦¬í•œë‹¤.**
* ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ì—”í‹°í‹° ë§¤ë‹ˆì €ë¥¼ ìƒì„±í•  ë•Œ í•˜ë‚˜ ë§Œë“¤ì–´ì§„ë‹¤. ê·¸ë¦¬ê³  ì—”í‹°í‹° ë§¤ë‹ˆì €ë¥¼ í†µí•´ì„œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆê³ , ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

> `persist()` ë©”ì„œë“œëŠ” ì—”í‹°í‹° ë©”ë‹ˆì €ë¥¼ ì‚¬ìš©í•´ì„œ íšŒì› ì—”í‹°í‹°ë¥¼ ì˜ì†ì„± ì»¨íƒìŠ¤íŠ¸ì— ì €ì¥í•œë‹¤.
```java
em.persist(member);
```

## ğŸ’šì—”í‹°í‹°ì˜ ìƒëª…ì£¼ê¸° 
ì—”í‹°í‹°ì—ëŠ” 4ê°€ì§€ì˜ ìƒíƒœê°€ ì¡´ì¬í•œë‹¤.
* ë¹„ì˜ì†(`new/transient`): ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ ì „í˜€ ê´€ê³„ê°€ ì—†ëŠ” ìƒíƒœ 
* ì˜ì†(`managed`): ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥ëœ ìƒíƒœ 
* ì¤€ì˜ì†(`detached`): ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥ë˜ì—ˆë‹¤ê°€ ë¶„ë¦¬ëœ ìƒíƒœ 
* ì‚­ì œ(`removed`): ì‚­ì œëœ ìƒíƒœ

### ë¹„ì˜ì† 
* ì•„ë˜ ì½”ë“œë¥´ ë³´ë©´ ìˆœìˆ˜í•œ ê°ì²´ ìƒíƒœì´ë©° ì•„ì§ ì €ì¥í•˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ì˜ì†ì„± í°í…ìŠ¤íŠ¸ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ì™€ëŠ” ì „í˜€ ê´€ê³„ ì—†ë‹¤. 
* ì´ê²ƒì„ ë¹„ì˜ì† ìƒíƒœë¼ í•œë‹¤. 
```java
// ê°ì²´ë¥¼ ìƒì„±í•œ ìƒíƒœ(ë¹„ì˜ì†)
Member member = new Member();
member.setId("member1");
member.setUsername("íšŒì›1");
```

### ì˜ì† 
* ì—”í‹°í‹° ë§¤ë‹ˆì €ë¥¼ í†µí•´ì„œ ì—”í‹°í‹°ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥í–ˆë‹¤. 
* ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ê´€ë¦¬í•˜ëŠ” ì—”í‹°í‹°ë¥¼ ì˜ì† ìƒíƒœë¼ í•œë‹¤. 
* ê·¸ë¦¬ê³  `em.find()`ë‚˜ JPQLì„ ì‚¬ìš©í•´ì„œ ì¡°íšŒí•œ ì—”í‹°í‹°ë„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ê´€ë¦¬í•˜ëŠ” ì˜ì† ìƒíƒœë‹¤.
```java
// ê°ì²´ë¥¼ ì €ì¥í•œ ìƒíƒœ(ì˜ì†)
em.persist(member);
```

### ì¤€ì˜ì† 
* ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ê´€ë¦¬í•˜ë˜ ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ê´€ë¦¬í•˜ì§€ ì•Šìœ¼ë©´ ì¤€ì˜ì† ìƒíƒœê°€ ëœë‹¤.
* `em.detach()` í˜¸ì¶œ 
* `em.close()` í˜¸ì¶œ: ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ë‹«ê¸° 
* `em.clear()` í˜¸ì¶œ: ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
```java
// íšŒì› ì—”í‹°í‹°ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë¶„ë¦¬, ì¤€ì˜ì† ìƒíƒœ
em.detach(member);
```

### ì‚­ì œ
* ì—”í‹°í‹°ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚­ì œí•œë‹¤. 
```java
// ê°ì²´ë¥¼ ì‚­ì œí•œ ìƒíƒœ(ì‚­ì œ)
em.remove(member);
```

![Image](https://github.com/user-attachments/assets/ee4273e4-aed6-48ab-8922-58c1a18b4c06)

## ğŸ“Œì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ íŠ¹ì§• 
* ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ ì‹ë³„ì ê°’ 
  * ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ì—”í‹°í‹°ë¥¼ ì‹ë³„ì ê°’ìœ¼ë¡œ êµ¬ë¶„í•œë‹¤.
  * ì˜ì† ìƒíƒ€ë‚´ëŠ” ì‹ë³„ì ê°’ì´ ë°˜ë“œì‹œ ìˆì–´ì•¼í•œë‹¤. ì—†ìœ¼ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤. 
* ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥ 
  * JPAëŠ” ë³´í†µ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ëŠ” ìˆœê°„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ìƒˆë¡œ ì €ì¥ëœ ì—”í‹°í‹°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜í•˜ëŠ”ë° ì´ê²ƒì„ í”ŒëŸ¬ì‹œ(`flush`)ë¼ í•œë‹¤.
* ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì—”í‹°í‹°ë¥¼ ê´€ë¦¬í•˜ëŠ” ê²ƒì˜ ì¥ì  
  * 1ì°¨ ìºì‹œ, ë™ì¼ì„± ë³´ì¥, ë³€ê²½ ê°ì§€, ì§€ì—° ë¡œë”©
  * íŠ¸ëœì­ì…˜ì„ ì§€ì›í•˜ëŠ ì“°ê¸° ì§€ì—°

## ğŸ“ˆì—”í‹°í‹° ì¡°íšŒ 
> ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ë‚´ë¶€ì— ìºì‹œë¥¼ ê°€ì§€ê³  ìˆëŠ”ë° ì´ê²ƒì„ 1ì°¨ ìºì‹œë¼ í•œë‹¤. ì˜ì†ì„± ìƒíƒœì˜ ì—”í‹°í‹°ëŠ” ëª¨ë‘ ì´ê³³ì— ì €ì¥ëœë‹¤. <br>
> ì¦‰, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ë‚´ë¶€ì— Mapì´ í•˜ë‚˜ ìˆëŠ”ë° í‚¤ëŠ” `@Id`ë¡œ ë§¤í•‘í•œ ì‹ë³„ìê³  ê°’ì€ ì—”í‹°í‹° ì¸ìŠ¤í„´ìŠ¤ì´ë‹¤.

* ì•„ë˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ 1ì°¨ ìºì‹œì— íšŒì› ì—”í‹°í‹°ë¥¼ ì €ì¥í•œë‹¤. íšŒì› ì—”í‹°í‹°ëŠ” ì•„ì§ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë˜ì§€ ì•Šì•˜ë‹¤.
* 1ì°¨ ìºì‹œì˜ í‚¤ëŠ” ì‹ë³„ì ê°’ì´ë‹¤. ê·¸ë¦¬ê³  ì‹ë³„ì ê°’ì€ ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë³¸ í‚¤ì™€ ë§¤í•‘ë˜ì–´ ìˆë‹¤.
* ë”°ë¼ì„œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ì¡°íšŒí•˜ëŠ” ëª¨ë“  ê¸°ì¤€ì€ ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë³¸ í‚¤ ê°’ì´ë‹¤.

```java
// ì—”í‹°í‹°ë¥¼ ìƒì„±í•œ ìƒíƒœ(ë¹„ì˜ì†)
Member member = new Member();
member.setId("member1");
member.setUsername("íšŒì›1");

// ì—”í‹°í‹°ë¥¼ ì˜ì†
em.persist(member);
```
* `find()`ë©”ì†Œë“œì˜ ì²«ë²ˆì§¸ íŒŒë¼ë¯¸í„°ëŠ” ì—”í‹°í‹° í´ë˜ìŠ¤ì˜ íƒ€ì…ì´ê³ , ë‘ë²ˆì§¸ëŠ” ì¡°íšŒí•  ì—”í‹°í‹°ì˜ ì‹ë³„ì ê°’ì´ë‹¤.
* `em.find()`ë¥¼ í˜¸ì¶œí•˜ë©´ **ë¨¼ì € 1ì°¨ ìºì‹œì—ì„œ ì—”í‹°í‹°ë¥¼ ì°¾ê³  ë§Œì•½ ì°¾ëŠ” ì—”í‹°í‹°ê°€ 1ì°¨ ìºì‹œì— ì—†ìœ¼ë©´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•œë‹¤.**
```java
Member member = em.find(Member.class, "member1");
```

![Image](https://github.com/user-attachments/assets/22264abd-b3a6-472a-9cc7-fc8056da7e23)

## ğŸ’©1ì°¨ ìºì‹œì—ì„œ ì¡°íšŒ 

* `em.find()`ë¥¼ í˜¸ì¶œí•˜ë©´ ë¨¼ì € 1ì°¨ ìºì‹œì—ì„œ ì‹ë³„ì ê°’ìœ¼ë¡œ ì—”í‹°í‹°ë¥¼ ì°¾ëŠ”ë‹¤. 
* ì°¾ëŠ” ì—”í‹°í‹°ê°€ ìˆìœ¼ë©´ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¡°íšŒí•˜ì§€ ì•Šê³  ë©”ëª¨ë¦¬ì— ìˆëŠ” 1ì°¨ ìºì‹œì—ì„œ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•œë‹¤.

```java
Member member = new Member();
member.setId("member1");
member.setUsername("íšŒì›1");

// 1ì°¨ ìºì‹œì— ì €ì¥ë¨
em.persist(member);

// 1ì°¨ ìºì‹œì—ì„œ ì¡°íšŒ
Member findMember = em.find(Member.class, "member1");
```

![Image](https://github.com/user-attachments/assets/3748f9dd-69a7-4888-859f-af5d2319769e)

## ğŸŒë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒ 
* ì—”í‹°í‹°ê°€ 1ì°¨ ìºì‹œì— ì—†ìœ¼ë©´ ì—”í‹°í‹° ë§¤ë‹ˆì €ëŠ” ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¡°íšŒí•´ì„œ ì—”í‹°í‹°ë¥¼ ìƒì„±í•œë‹¤. 
* ê·¸ë¦¬ê³  1ì°¨ ìºì‹œì— ì €ì¥í•œ í›„ì— ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ë¥¼ ë°˜í™˜í•œë‹¤.
```java
Member findMember2 = em.find(Member.class, "member2");
```

![Image](https://github.com/user-attachments/assets/2cdc2e15-8fe4-451f-b766-105429e6338e)

> ì´ì œ `member1`, `member2` ì—”í‹°í‹° ì¸ìŠ¤í„´ìŠ¤ëŠ” 1ì°¨ ìºì‹œì— ìˆë‹¤. ë”°ë¼ì„œ ì´ ì—”í‹°í‹°ë“¤ì„ ì¡°íšŒí•˜ë©´ ë©”ëª¨ë¦¬ì— ìˆëŠ” 1ì°¨ ìºì‹œì—ì„œ ë°”ë¡œ ë¶ˆëŸ¬ì˜¨ë‹¤.

## ğŸ¨ì˜ì† ì—”í‹°í‹°ì˜ ë™ì¼ì„± ë³´ì¥ 

* ìš”ê¸°ì„œ `a == b`ëŠ” ì°¸ì¼ê¹Œ ê±°ì§“ì¼ê¹Œ? ì •ë‹µì€ `true`ì´ë‹¤.
* `em.find(Member.class, "member1")`ë¥¼ ë°˜ë³µí•´ì„œ í˜¸ì¶œí•´ë„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” 1ì°¨ ìºì‹œì— ìˆëŠ” ê°™ì€ ì—”í‹°í‹° ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤. 
* ë”°ë¼ì„œ ë‘˜ì€ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ê³  ê²°ê³¼ëŠ” ë‹¹ì—°íˆ ì°¸ì´ë‹¤. 
* ì˜ì†ì„± ì»¨í…ìŠ¤ëŠ” ì„±ëŠ¥ìƒ ì´ì ê³¼ ì—”í‹°í‹°ì˜ ë™ì¼ì„±ì„ ë³´ì¥í•œë‹¤.
```java
Member a = em.find(Member.class, "member1");
Member b = em.find(Member.class, "member1");
System.out.println(a == b);
```

## ğŸ”€ì—”í‹°í‹° ë“±ë¡ 
* ì—”í‹°í‹° ë§¤ë‹ˆì €ëŠ” íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ê¸° ì§ì „ê¹Œì§€ ë°ì´í„°ë² ì´ìŠ¤ì— ì—”í‹°í‹°ë¥¼ ì €ì¥í•˜ì§€ ì•Šê³  ë‚´ë¶€ ì¿¼ë¦¬ ì €ì¥ì†Œì— `INSERT SQL`ì„ ì°¨ê³¡ì°¨ê³¡ ëª¨ì•„ë‘”ë‹¤.
* ê·¸ë¦¬ê³  íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•  ë•Œ ëª¨ì•„ë‘” ì¿¼ë¦¬ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ë³´ë‚´ëŠ”ë° ì´ê²ƒì„ íŠ¸ëœì­ì…˜ì„ ì§€ì›í•˜ëŠ” ì“°ê¸° ì§€ì—°(`transactional write-behind`)ì´ë¼ í•œë‹¤.

```java
EntityManager em = emf.createEntityManager();
EntityTransaction transaction = em.getTransaction();
// ì—”í‹°í‹° ë§¤ë‹ˆì €ëŠ” ë°ì´í„° ë³€ê²½ ì‹œ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•´ì•¼ í•œë‹¤.
transaction.begin();  // [íŠ¸ëœì­ì…˜] ì‹œì‘

em.persist(memberA);
em.persist(memberB);
// ì—¬ê¸°ê¹Œì§€ INSERT SQLì„ ë°ì´í„°ë² ì´ìŠ¤ì— ë³´ë‚´ì§€ ì•ŠëŠ”ë‹¤.

// ì»¤ë°‹í•˜ëŠ” ìˆœê°„ ë°ì´í„°ë² ì´ìŠ¤ì— INSERT SQLì„ ë³´ë‚¸ë‹¤.
transaction.commit();  // [íŠ¸ëœì­ì…˜] ì»¤ë°‹
```

* ë¨¼ì € `memberA`ë¥¼ ì˜ì†í™”í•˜ê³ , ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” 1ì°¨ ìºì‹œì— íšŒì› ì—”í‹°í‹°ë¥¼ ì €ì¥í•˜ë©´ì„œ ë™ì‹œì— íšŒì› ì—”í‹°í‹° ì •ë³´ë¡œ ë“±ë¡ ì¿¼ë¦¬ë¥¼ ë§Œë“ ë‹¤.
* ë§Œë“¤ì–´ì§„ ë“±ë¡ ì¿¼ë¦¬ë¥¼ ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì— ë³´ê´€í•œë‹¤.

![Image](https://github.com/user-attachments/assets/6bd6bdf4-e12a-41b1-a1b7-4c9aa4bbb1e5)

* í˜„ì¬ ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì—ëŠ” ë“±ë¡ ì¿¼ë¦¬ê°€ 2ê±´ ì €ì¥ë˜ì—ˆë‹¤. `(memberA, memberB)`
* ë§ˆì§€ë§‰ìœ¼ë¡œ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í–ˆë‹¤. íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ë©´ ì—”í‹°í‹° ë§¤ë‹ˆì €ëŠ” ìš°ì„  ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ í”ŒëŸ¬ì‹œí•œë‹¤.
* í”ŒëŸ¬ì‹œëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë³€ê²½ ë‚´ìš©ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ë™ê¸°í™”í•˜ëŠ” ì‘ì—…ì¸ë° ì´ë•Œ ë“±ë¡, ìˆ˜ì •, ì‚­ì œí•œ ì—”í‹°í‹°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜í•œë‹¤.
* ì¦‰, ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì— ëª¨ì¸ ì¿¼ë¦¬ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ë³´ë‚¸ë‹¤. 
* ì´ë ‡ê²Œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë³€ê²½ ë‚´ìš©ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ë™ê¸°í™”í•œ í›„ì— ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•œë‹¤.

![Image](https://github.com/user-attachments/assets/809a028a-36e0-4347-8eb0-db4bda2f2f39)

## ğŸ“¦ì—”í‹°í‹° ìˆ˜ì •
> SQL ìˆ˜ì • ì¿¼ë¦¬ì˜ ë¬¸ì œì 

* SQLì„ ì‚¬ìš©í•˜ë©´ ìˆ˜ì • ì¿¼ë¦¬ë¥¼ ì§ì ‘ ì‘ì„±í•´ì•¼ í•œë‹¤. ê·¸ëŸ°ë° í”„ë¡œì íŠ¸ê°€ ì ì  ì»¤ì§€ê³  ìš”êµ¬ì‚¬í•­ì´ ëŠ˜ì–´ë‚˜ë©´ì„œ ìˆ˜ì • ì¿¼ë¦¬ë„ ì ì  ì¶”ê°€ëœë‹¤. 
* ì´ëŸ° ê°œë°œ ë°©ì‹ì˜ ë¬¸ì œì ì€ ìˆ˜ì • ì¿¼ë¦¬ê°€ ë§ì•„ì§€ëŠ” ê²ƒì€ ë¬¼ë¡ ì´ê³  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë¶„ì„í•˜ê¸° ìœ„í•´ SQLì„ ê³„ì† í™•ì¸í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤. 
* ê²°êµ­ ì§ì ‘ì ì´ë“  ê°„ì ‘ì ì´ë“  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ SQLì— ì˜ì¡´í•˜ê²Œ ëœë‹¤.

### ë³€ê²½ ê°ì§€ 

* JPAë¡œ ì—”í‹°í‹°ë¥¼ ìˆ˜ì •í•  ë•ŒëŠ” ë‹¨ìˆœíˆ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•´ì„œ ë°ì´í„°ë§Œ ë³€ê²½í•˜ë©´ ëœë‹¤.
* ì—”í‹°í‹°ì˜ ë³€ê²½ì‚¬í•­ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ìë™ìœ¼ë¡œ ë°˜ì˜í•˜ëŠ” `ë³€ê²½ ê°ì§€ ê¸°ëŠ¥`ì´ ìˆê¸° ë•Œë¬¸ì—, ì—”í‹°í‹°ì˜ ë°ì´í„°ë§Œ ë³€ê²½í•´ë„ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜ì´ ëœë‹¤.

```java
EntityManager em = emf.createEntityManager();
EntityTransaction transaction = em.getTransaction();
transaction.begin();  // íŠ¸ëœì­ì…˜ ì‹œì‘

// ì˜ì† ì—”í‹°í‹° ì¡°íšŒ
Member memberA = em.find(Member.class, "memberA");

// ì˜ì† ì—”í‹°í‹° ë°ì´í„° ìˆ˜ì •
memberA.setUsername("hi");
memberA.setAge(10);

// em.update(member) ì´ëŸ° ì½”ë“œê°€ ìˆì–´ì•¼ í•˜ì§€ ì•Šì„ê¹Œ?
 
transaction.commit();  // íŠ¸ëœì­ì…˜ ì»¤ë°‹
```

* JPAëŠ” ì—”í‹°í‹°ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë³´ê´€í•  ë•Œ ìµœì´ˆ ìƒíƒœë¥¼ ë³µì‚¬í•´ì„œ ì €ì¥í•´ë‘ëŠ”ë° ì´ê²ƒì„ `ìŠ¤ëƒ…ìƒ·`ì´ë¼ í•œë‹¤. 
* ê·¸ë¦¬ê³  í”ŒëŸ¬ì‹œ ì‹œì ì— ìŠ¤ëƒ…ìƒ·ê³¼ ì—”í‹°í‹°ë¥¼ ë¹„êµí•´ì„œ ë³€ê²½ëœ ì—”í‹°í‹°ë¥¼ ì°¾ëŠ”ë‹¤.
* ë³€ê²½ ê°ì§€ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ê´€ë¦¬í•˜ëŠ” ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ë§Œ ì ìš©ëœë‹¤. 

1. íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ë©´ ì—”í‹°í‹° ë§¤ë‹ˆì € ë‚´ë¶€ì—ì„œ ë¨¼ì € í”ŒëŸ¬ì‹œ(flush())ê°€ í˜¸ì¶œëœë‹¤. 
2. ì—”í‹°í‹°ì™€ ìŠ¤ëƒ…ìƒ·ì„ ë¹„êµí•´ì„œ ë³€ê²½ëœ ì—”í‹°í‹°ë¥¼ ì°¾ëŠ”ë‹¤. 
3. ë³€ê²½ëœ ì—”í‹°í‹°ê°€ ìˆìœ¼ë©´ ìˆ˜ì • ì¿¼ë¦¬ë¥¼ ìƒì„±í•´ì„œ ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì— ë³´ë‚¸ë‹¤. 
4. ì“°ê¸° ì§€ì—° ì €ì¥ì†Œì˜ SQLì„ ë°ì´í„°ë² ì´ìŠ¤ì— ë³´ë‚¸ë‹¤. 
5. ë°ì´í„°ë² ì´ìŠ¤ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•œë‹¤.

![Image](https://github.com/user-attachments/assets/c91b92ac-d206-4d98-9279-de3f2d8adbd1)

## ğŸššë³€ê²½ ê°ì§€ë¡œ ì¸í•œ `UPDATE SQL`

> íšŒì›ì˜ ì´ë¦„ê³¼ ë‚˜ì´ë§Œ ìˆ˜ì •í•˜ë©´ ë³€ê²½ëœ ë¶€ë¶„ë§Œ ì‚¬ìš©í•´ì„œ ë™ì ìœ¼ë¡œ ìˆ˜ì • ì¿¼ë¦¬ê°€ ìƒì„±ë ê±° ê°™ì§€ë§Œ ì•„ë‹ˆë‹¤!
* JPAì˜ ê¸°ë³¸ ì „ëµì€ ì—”í‹°í‹°ì˜ ëª¨ë“  í•„ë“œë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒì¸ë°, ì´ ë°©ì‹ì€ ë°ì´í„°ë² ì´ìŠ¤ì— ë³´ë‚´ëŠ” ë°ì´í„° ì „ì†¡ëŸ‰ì´ ì¦ê°€í•˜ëŠ” ë‹¨ì ì´ ìˆì§€ë§Œ ë‹¤ìŒê³¼ ê°™ì€ ì¥ì ì´ ìˆë‹¤.
  * ëª¨ë“  í•„ë“œë¥¼ ì‚¬ìš©í•˜ë©´ ìˆ˜ì • ì¿¼ë¦¬ê°€ í•­ìƒ ê°™ë‹¤. ë”°ë¼ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œë”© ì‹œì ì— ìˆ˜ì • ì¿¼ë¦¬ë¥¼ ë¯¸ë¦¬ ìƒì„±í•´ë‘ê³  ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 
  * ë°ì´í„°ë² ì´ìŠ¤ì— ë™ì¼í•œ ì¿¼ë¦¬ë¥¼ ë³´ë‚´ë©´ ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì´ì „ì— í•œ ë²ˆ íŒŒì‹±ëœ ì¿¼ë¦¬ë¥¼ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 
* í•„ë“œê°€ ë§ê±°ë‚˜ ì €ì¥ë˜ëŠ” ë‚´ìš©ì´ ë„ˆë¬´ í¬ë©´ ìˆ˜ì •ëœ ë°ì´í„°ë§Œ ì‚¬ìš©í•´ì„œ ë™ì ìœ¼ë¡œ `UPDATE SQL`ì„ ìƒì„±í•˜ëŠ” ì „ëµì„ ì„ íƒí•˜ë©´ ëœë‹¤. ë‹¨, ì´ë•ŒëŠ” í•˜ì´ë²„ë„¤ì´íŠ¸ í™•ì¥ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.


í•„ë“œê°€ ë§ê±°ë‚˜ ì €ì¥ë˜ëŠ” ë‚´ìš©ì´ ë„ˆë¬´ í¬ë©´ ìˆ˜ì •ëœ ë°ì´í„°ë§Œ ì‚¬ìš©í•´ì„œ ë™ì ìœ¼ë¡œ UPDATE SQLì„ ìƒì„±í•˜ëŠ” ì „ëµì„ ì„ íƒí•˜ë©´ ëœë‹¤. ë‹¨, ì´ë•ŒëŠ” í•˜ì´ë²„ë„¤ì´íŠ¸ í™•ì¥ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
* `org.hibernate.annotations.DynamicUpdate` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ë©´ ìˆ˜ì •ëœ ë°ì´í„°ë§Œ ì‚¬ìš©í•´ì„œ ë™ì ìœ¼ë¡œ `UPDATE SQL`ì„ ìƒì„±í•œë‹¤.
* ë°ì´í„°ë¥¼ ì €ì¥í•  ë•Œ ë°ì´í„°ê°€ ì¡´ì¬í•˜ëŠ”(nullì´ ì•„ë‹Œ) í•„ë“œë§Œìœ¼ë¡œ `INSERT SQL`ì„ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” `@DynamicInsert`ë„ ìˆë‹¤.

```java
@Entity
@org.hibernate.annotations.DynamicUpdate
@Table(name = "Member")
public class Member {...}
```

## ğŸ»`flush()` í”ŒëŸ¬ì‹œ
> í”ŒëŸ¬ì‹œëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë³€ê²½ ë‚´ìš©ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜í•œë‹¤.

í”ŒëŸ¬ì‹œë¥¼ ì‹¤í–‰í•˜ë©´ ì¼ì–´ë‚˜ëŠ” ì¼ 
1. ë³€ê²½ ê°ì§€ê°€ ë™ì‘í•´ì„œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ìˆëŠ” ëª¨ë“  ì—”í‹°í‹°ë¥¼ ìŠ¤ëƒ…ìƒ·ê³¼ ë¹„êµí•´ì„œ ìˆ˜ì •ëœ ì—”í‹°í‹°ë¥¼ ì°¾ëŠ”ë‹¤. ìˆ˜ì •ëœ ì—”í‹°í‹°ëŠ” ìˆ˜ì • ì¿¼ë¦¬ë¥¼ ë§Œë“¤ì–´ ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì— ë“±ë¡í•œë‹¤.
2. ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì˜ ì¿¼ë¦¬ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì „ì†¡í•œë‹¤.

ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ í”ŒëŸ¬ì‹œí•˜ëŠ” ë°©ë²• 
1. em.flush()ë¥¼ ì§ì ‘ í˜¸ì¶œí•œë‹¤.
2. íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œ í”ŒëŸ¬ì‹œê°€ ìë™ í˜¸ì¶œëœë‹¤.
3. JPQL ì¿¼ë¦¬ ì‹¤í–‰ ì‹œ í”ŒëŸ¬ì‹œê°€ ìë™ í˜¸ì¶œëœë‹¤.

## ğŸ™ˆì¤€ì˜ì† 
> ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ê´€ë¦¬í•˜ëŠ” ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ê°€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë¶„ë¦¬ëœ ê²ƒì„ ì¤€ì˜ì† ìƒíƒœë¼ê³  í•œë‹¤. <br>
ë”°ë¼ì„œ ì¤€ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

ì˜ì† ìƒíƒœì˜ ì—”í‹°íŒ‰ë¥¼ ì¤€ì˜ì† ìƒíƒœë¡œ ë§Œë“œëŠ” ë°©ë²•
1. `em.detach(entity)`: íŠ¹ì • ì—”í‹°í‹°ë§Œ ì¤€ì˜ì† ìƒíƒœë¡œ ì „í™˜í•œë‹¤.
2. `em.clear()`: ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì™„ì „íˆ ì´ˆê¸°í™”í•œë‹¤.
3. `em.close()`: ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì¢…ë£Œí•œë‹¤.

## ğŸ“¦ì—”í‹°í‹°ë¥¼ ì¤€ì˜ì† ìƒíƒœë¡œ ì „í™˜: `detach()`
> `em.detach()` ë©”ì†Œë“œëŠ” íŠ¹ì • ì—”í‹°í‹°ë¥¼ ì¤€ì˜ì† ìƒíƒœë¡œ ë§Œë“ ë‹¤.

* ë¨¼ì € íšŒì› ì—”í‹°í‹°ë¥¼ ìƒì„±í•˜ê³  ì˜ì†í™”í•œ ë‹¤ìŒ `em.detach(member)`ë¥¼ í˜¸ì¶œí–ˆë‹¤.
* **ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ê²Œ ë”ëŠ” í•´ë‹¹ ì—”í‹°í‹°ë¥¼ ê´€ë¦¬í•˜ì§€ ë§ë¼ëŠ” ê²ƒì´ë‹¤.**
* `em.detach(member)`ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ìˆœê°„ 1ì°¨ ìºì‹œë¶€í„° ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œê¹Œì§€ í•´ë‹¹ ì—”í‹°í‹°ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ëª¨ë“  ì •ë³´ê°€ ì œê±°ëœë‹¤.
```java
public void testDetached() {
	// íšŒì› ì—”í‹°í‹° ìƒì„±, ë¹„ì˜ì† ìƒíƒœ
	Member member = new Member();
    member.setId("memberA");
	member.setUsername("íšŒì›A");

	// íšŒì› ì—”í‹°í‹° ì˜ì† ìƒíƒœ
    em.persist(member);
    
    // íšŒì› ì—”í‹°í‹°ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë¶„ë¦¬, ì¤€ì˜ì† ìƒíƒœ
    em.detach(member);
 
	transaction.commit();  // íŠ¸ëœì­ì…˜ ì»¤ë°‹
}
```
* ì•„ë˜ ì´ë¯¸ì§€ì²˜ëŸ¼ `em.detach(member)`ë¥¼ ì´ìš©í•´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ `memberA`ì— ëŒ€í•œ ëª¨ë“  ì •ë³´ë¥¼ ì‚­ì œí•´ ë²„ë ¸ë‹¤.
* ì´ë ‡ê²Œ ì˜ì† ìƒíƒœì˜€ë‹¤ê°€ ë”ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ” ìƒíƒœë¥¼ `ì¤€ì˜ì† ìƒíƒœ`ë¼ê³  í•œë‹¤.

![Image](https://github.com/user-attachments/assets/80964923-2269-4174-8ca7-29459abce601)

## ğŸ›ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”: `clear()`
> `em.detach()`ê°€ íŠ¹ì • ì—”í‹°í‹° í•˜ë‚˜ë¥¼ ì¤€ì˜ì† ìƒíƒœë¡œ ë§Œë“¤ì—ˆë‹¤ë©´ <br>
`em.clear()`ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì´ˆê¸°í™”í•´ì„œ í•´ë‹¹ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ëª¨ë“  ì—”í‹°í‹°ë¥¼ ì¤€ì˜ì† ìƒíƒœë¡œ ë§Œë“ ë‹¤.

* ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ìˆëŠ” ëª¨ë“  ê²ƒì´ ì´ˆê¸°í™”ë˜ì—ˆë‹¤. 
* ì´ì œ `member`ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ê´€ë¦¬í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì¤€ì˜ì† ìƒíƒœì´ê³ , ë”°ë¼ì„œ ë³€ê²½ ê°ì§€ëŠ” ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤. 
* ì¦‰, íšŒì›ì˜ ì´ë¦„ì„ ë³€ê²½í•´ë„ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜ë˜ì§€ ì•ŠëŠ”ë‹¤.
```java
Member member = em.find(Member.class, "memberA");

em.clear();  // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
// ì¤€ì˜ì† ìƒíƒœ
member.setUsername("changeName");  // ë³€ê²½ ê°ì§€ ì•ˆë¨ 
```


## ğŸš‘ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì¢…ë£Œ: `close()`
> ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì¢…ë£Œí•˜ë©´ í•´ë‹¹ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ê´€ë¦¬í•˜ë˜ ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ê°€ ëª¨ë‘ ì¤€ì˜ì† ìƒíƒœê°€ ëœë‹¤.
* ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì¢…ë£Œë˜ì–´ ë”ëŠ” `memberA`, `memberB`ê°€ ê´€ë¦¬ë˜ì§€ ì•ŠëŠ”ë‹¤.
```java
public void closeEntityManager(){
	EntityManagerFactory emf = Persistence.createEntityManagerFactory("jpabook");
    EntityManager em = emf.createEntityManager();
    EntityTransaction transaction = em.getTransaction();
    
    transaction.begin();
    
    Member member = em.find(Member.class, "memberA");
    Member member = em.find(Member.class, "memberB");
    
    transaction.commit();
    
    em.close();  // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê¸°
}
```


