# 📚 Spring - Redis 알아보기

> 💡 Redis는 동시성 문제를 해결할때 주로 많이 사용합니다.

## Redis 란?
- 고성능의 키-값(`key-value`) 저장소로, 거대한 맵(`Map`) 데이터 저장소형태를 가지고 데이터를 메모리에 저장하여 빠른 읽기와 쓰기를 지원합니다.
- 주로 캐싱, 인증 관리, DB 동시성 제어 등에서 다양한 목적으로 사용 

## Redis 특징 
- `key-value`로 구성된 단순화된 데이터 구조로 `SQL`쿼리 사용이 불필요
- `Redis`는 인메모리 NoSQL 데이터베이스로서 빠른 성능을 가짐 
- `Single Thread` 구조로 동시성 이슈가 발생하지 않는다.

## Redis가 빠른 성능을 낼수 있는 이유 
1. `Redis`는 인메모리 방식으로 데이터를 하드디스크에 저장하지 않고 메모리에 저장을 하기 때문에 성능이 빠르다.
   - 하드디스크는 용량이 크지만 매우 느리고 메모리는 용량은 적지만 매우 빠르다.
2. `key-value`는 구조적으로 해시 테이블을 사용함으로써 데이터 검색이 매우 빠르다. 
   - 해시 테이블을 사용하지 않으면 `DB`를 `Full Table Scan`하기 때문에 조회 속도가 매우 느림 
   - 해시 테이블을 사용하면 데이터를 삽입할 때 `Hash`알고리즘으로 암호화하를 시켜서 나오는 암호를 메모리 주소로 사용합니다. 
   - 즉, `user1` 데이터를 줘 라고 할때 암호가 메모리 주소이기 때문에 매우 빠르게 조회가 가능 합니다.
   
<img width="1361" height="775" alt="Image" src="https://github.com/user-attachments/assets/95c82cf5-ae11-41aa-a8f2-8a9f222ff79d" />

## `Single Thread`의 장점 
- `RDB` 형식의 데이터베이스는 사용자가 많으면 데이터를 동시에 처리하는 걸 지원합니다. 
- 하지만 동시성을 지원하다 보니 `Race Condition` 현상이 발생합니다. 
- 이때 `Redis`는 기본적으로 `Single Thread` 기반이여서 동시성 이슈가 발생하지 않습니다. 
- 즉, `Single Thread`는 한 번에 한 사용자 요청만 처리할 수 있어 사용자가 몰려 들어와도 빠르게 한명씩 차례대로 처리해줍니다.

<img width="908" height="928" alt="Image" src="https://github.com/user-attachments/assets/72bf6a59-48b3-40bb-b095-c3a434457a48" />

## Redis 데이터베이스는 16개로 구성 되어있다. 
- `Redis`는 데이터베이스를 구분합니다. 0~15까지로 총 16개로 구성되어 있습니다. 
- 최초 접속시 `default`는 0번입니다. 다른 데이터 베이스 검색은 `select DB번호` 형식으로 합니다.
  - ex) `select 10` 10번 데이터베이스 검색 
- `Redis`에서 데이터베이스를 나누는 이유는 하나의 레디스에서 다양한 목적으로 데이터베이스 분리시키기 위해서 사용 
  - ex) `select 0`에는 사용자 인증, `select 1`에는 캐싱, `select 2`상품 정보 저장 처럼 분리 

## Redis 기본 문법 
> 아래는 Redis 명령어 직접 사용하지만 스프링에서는 라이브러리를 사용해서 명령어 사용합니다.
```shell
# 데이터베이스 내 모든 키 조회 
Keys *

# 일반적인 String 구조 
# set을 통해 key:value 세팅, 
set user:email:1 lim1@naver.com

# Redis는 Map형식이므로 이미 key가 있는데 set하면 value를 덮어 버립니다.
# nx : 이미 존재하면 Pass, 존재하지 않다면 set
set user:email:2 lim2@naver.com nx

# ex(expiration) : 만료시간(초 단위), TTL 설정 
set user:email:3 lim3@naver.com ex 10

# 특정 Key의 값을 가져옴
get user:email:1 

# 특정 Key 삭제
del user:email:1 

# 현재 DB내 모든 Key 삭제
flushdb
```

## Redis 활용 
> 아래는 Redis 명령어 직접 사용하지만 스프링에서는 라이브러리를 사용해서 명령어 사용합니다.
- 사용자 인증정보 저장
- 좋아요 기능 구현
- 재고 관리
- 캐싱 기능 구현

```shell
# Redis 활용 : 사용자 인증정보 저장(ex-refresh토큰)
set user:1:refresh_token eyjaxvaalsw ex 100000

# Redis 활용 : 좋아요 기능 구현
set likes:post:1 0 # 1번 게시물 좋아요에 0값을 넣음 
incr likes:post:1 # 특정 Key값의 Value를 1만큼 증가 
decr likes:post:1 # 특정 Key값의 Value를 1만큼 감소 
get likes:post:1 # 특정 Key의 값을 가져옴

# Redis 활용 : 재고 관리 
set stocks:product:1 100
decr stocks:product:1 
get stocks:product:1

# Redis 활용 : 캐싱 기능 구현 
# RDB에서 읽은 데이터를 JSON형태로 Value값으로 저장하는게 캐싱 원리 
set posting:1 "{"title":"hello Redis", "contents":"Good Java"}" ex 100
```