# 📚 Spring - Redis 자료구조

> 💡 자료구조에 따라 활용하기 

## List 자료 구조 
- `deque` 또는 `double-ended queue`와 유사한 구조
- `List` 자료구조는 데이터가 하나만 들어가는게 아니라 멀티 자료 구조로 되어있습니다. 
- 하나의 Key 값에 여러 데이터 자료들이 들어갑니다. 
- `List`는 중간에 데이터를 삽입 할 수 없습니다. 

```shell
# list 자료 구조 : deque 와 유사한 구조 
# lpush : 데이터를 왼쪽 끝에 삽입 
# rpush : 데이터를 오른쪽 끝에 삽입 
# lpop : 데이터를 왼쪽에서 꺼내기 
# rpop : 데이터를 오른쪽에서 꺼내기 

lpush fruit Apple 
lpush fruit Banana
rpush fruit Orange

# list 조회 
# -1은 리스트의 끝자리(마지막 Index)를 의미, -2는 끝에서 2번째를 의미 
lrange fruit 0 0 # 첫 번째 값만 조회 (Banana)
lrange fruit -1 -1 # 마지막 값만 조회 (Orange)
lrange fruit 0 -1 # 처음부터 끝까지 조회 Banana, Apple, Orange 순으로 들어가있음 
lrange fruit -2 -1 # 마지막 2번째 부터 마지막 자리까지 Apple, Orange
lrange fruit 2 1 # 처음부터 2번째 까지 Banana, Apple

# 데이터 개수 조회
llen fruit 

# TTL 적용 
expire fruit 20 
# TTL 조회 
ttl fruit 
```

## Redis List 자료 구조 활용 
- 최근 방문한 페이지
- 최근 조회한 상품 목록
```shell
# 최근 방문한 페이지, 최근 조회한 상품 목록 
rpush mypages www.naver.com
rpush mypages www.google.com
rpush mypages www.daum.net
rpush mypages www.chatgpt.com
rpush mypages www.daum.net

# 최근 방문한 페이지 3개만 보여주는 
lrange mypages -3 -1 
```

---
## Set 자료 구조 
- `Set`은 순서가 없고 중복이 없는 자료구조
```shell
# set 자료구조 : 순서가 없고 중복이 없는 자료구조
# set에 값 추가하기 
sadd memberlist member1
sadd memberlist member1 # 증복이 되서 제거 추가 X
sadd memberlist member2

# set 조회 
smembers memberlist

# set 요소의 개수 조회 
scard memberlist 

# set에서 멤버 제거 
srem memberlist member2

# 특정 멤버가 set안에 들어있는지 확인 
sismember memberlist member1 # 있으면 1 없으면 0 
```

## Redis Set 자료 구조 활용
- 좋아요 구현 
- 매일 방문자 수 계산
```shell
# 좋아요 구현 
sadd likes:posting:1 member1
sadd likes:posting:1 member2
sadd likes:posting:1 member1

# 좋아요 개수 
scard likes:posting:1 member1
# 좋아요 눌렀는지 안눌렀는지 확인 
sismember likes:posting:1 member1 
```

---
## Zset(정렬된 집합) 자료 구조
- 정렬의 기준이 되는 `score`를 가지고 있는 `set`
- `ZSet`은 스코어 기준으로 요소를 정렬하며 중복을 제거합니다.

```shell
# zset : sorted set 
# add하는 score를 부여하고, score를 기준으로 정렬 
zadd memberlist 3 member1
zadd memberlist 4 member2
zadd memberlist 1 member3
zadd memberlist 2 member4 

# 조회방법 : 기본적으로 score기준 오름차순정렬 
zrange memberlist 0 -1 # member3, member4, member1, member2 순으로 정렬 

# 내림차순 정렬 
zrevrange memberlist 0 -1 # member2, member1, member4, member3 순으로 정렬 

# zset 요소 삭제 
zrem memberlist member4

# zrank : 특정 요소가 몇번째 순서인지 출력 (오름차순 기준)
zrank memberlist member1 # member3은 2번째 인덱스여서 2가 나옴 
```

## Redis Zset(정렬된 집합) 자료 구조 활용 
- 최근 본 상품 목록 
```shell
# redis 활용 : 최근 본 상품목록
# zset을 활용해서 최근시간순으로 정렬
# zset도 set이므로 같은 상품을 add할 경우에 시간만 업데이트되고 중복이 제거
# 같은 상품을 더할경우 시간만 마지막에 넣은 값으로 업데이트(중복제거)
zadd recent:products 151930 pineapple
zadd recent:products 152030 banana
zadd recent:products 152130 orange
zadd recent:products 152230 apple 
zadd recent:products 152330 apple

# 최근본 상품목록 3개 조회
zrevrange recent:products 0 2
zrevrange recent:products 0 2 withscores # score 까지 같이 조회 
```
- 주식 시세 저장
```shell
# redis활용사례 : 주식 시세 저장
# 종목명: 삼성전자, 시세: 72000원, 시간: 1672527600 (유닉스 타임스탬프) -> 년월일시간을 초단위로 변환한것.(밀리초 단위도 가능능)
zadd stock:prices:samsung 1672527600 "53000"

# 종목명: LG전자, 시세: 95000원, 시간: 1672527660
zadd stock:prices:lg 1672527660 "95000"

# 종목명: 삼성전자, 시세: 72500원, 시간: 1672527720
zadd stock:prices:samsung 1672527720 "72500"

# 종목명: LG전자, 시세: 94500원, 시간: 1672527780
zadd stock:prices:lg 1672527780 "94500"

# 삼성전자의 최신 시세 조회 (최대 1개)
zrevrange stock:prices:samsung 0 0 withscores
```

---
## Hashes 자료 구조
- `Value`값이 `map`형태인 자료구조

```shell
# hashes : map형태의 자료구조, value값이 {key:value key:value ...} 형태로 구성 
hset author:info:1 name lim email lim@naver.com age 24

# 특정 값 조회
hget author:info:1 name # lim 출력

# 모든 객체 값 조회
hgetall author:info:1 

# 특정 요소 값 수정
hset author:info:1 name kim

# 특정 요소 값의 값을 증가/감소 시킬 경우
hincrby member:info:1 age 3  # age 값을 3 증가한다. 그러면 24 + 3 = 27이 나옴 
hincrby member:info:1 age -3  # age 값을 3 감소한다. 그러면 27 - 3 = 24가 나옴 
```

## Redis Hashes 자료 구조 활용 
- 빈번하게 변경되는 객체 값 캐싱 
```shell
# JSON 형태의 문자열로 캐싱을 할경우, 해당 문자값을 수정할때에는 문자열을 파싱하여 통쨰로 변경해야 함 
# 값이 빈번하게 수정이 되지 않으면 JSON 형태로 넣어도 되지만, 수정하게 된다면 복잡해지면서 재 세팅 해야 해서 비효율적이다.
# Hashes는 hset라는 메서드로 값을 쉽게 수정이 가능하다. 

# 정리 : Hash는 내부 필드를 개별 수정하기 효율적입니다. JSON 문자열은 전체를 파싱하고 수정해야 해 자주 바뀌는 데이터 캐싱에 Hash가 유리합니다.
```