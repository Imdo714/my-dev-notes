# ğŸ“š ìŠ¤í”„ë§ - ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ì˜ì¡´ê´€ê³„ ìë™ ì£¼ì…

> ğŸ’¡ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì´ë€ `Spring`ì´ íŠ¹ì • íŒ¨í‚¤ì§€ë¥¼ ìë™ìœ¼ë¡œ ìŠ¤ìº”í•´ì„œ, ìŠ¤í”„ë§ ë¹ˆ(`bean`)ìœ¼ë¡œ ë“±ë¡í•  í´ë˜ìŠ¤ë“¤ì„ ì°¾ì•„ì£¼ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

## â˜•ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ì‚¬ìš©í•˜ê¸° 

* ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì„ ì‚¬ìš©í•˜ë ¤ë©´ ë¨¼ì € `@ComponentScan`ì„ ì„¤ì • ì •ë³´ì— ë¶™ì—¬ì£¼ë©´ ëœë‹¤.
* ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì€ ì´ë¦„ ê·¸ëŒ€ë¡œ `@Component` ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ í´ë˜ìŠ¤ë¥¼ ìŠ¤ìº”í•´ì„œ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•œë‹¤.
* `@Configuration`ì´ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì˜ ëŒ€ìƒì´ ëœ ì´ìœ ë„ `@Configuration` ì†ŒìŠ¤ì½”ë“œë¥¼ ì—´ì–´ë³´ë©´ `@Component`ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì–´ìˆê¸° ë•Œë¬¸ì´ë‹¤.

```java
@Configuration
@ComponentScan
public class AppConfig { }
```
* @Component ì• ë…¸í…Œì´ì…˜ì´ ë¶™ì€ í´ë˜ìŠ¤ë¥¼ ìŠ¤ìº”í•´ì„œ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•œë‹¤.

```java
@Component
public class MemoryMemberRepository implements MemberRepository {}
```
* @Component ì• ë…¸í…Œì´ì…˜ì´ ë¶™ì€ í´ë˜ìŠ¤ë¥¼ ìŠ¤ìº”í•´ì„œ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•œë‹¤.

```java
@Component
public class RateDiscountPolicy implements DiscountPolicy {}
```
* ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ì „ì—ëŠ” `AppConfig`ì—ì„œëŠ” `@Bean`ìœ¼ë¡œ ì§ì ‘ ì„¤ì • ì •ë³´ë¥¼ ì‘ì„±í–ˆê³ , ì˜ì¡´ê´€ê³„ë„ ì§ì ‘ ëª…ì‹œí–ˆë‹¤.
* ì´ì œëŠ” ì´ëŸ° ì„¤ì • ì •ë³´ ìì²´ê°€ ì—†ê¸° ë•Œë¬¸ì—, ì˜ì¡´ê´€ê³„ ì£¼ì…ë„ ì´ í´ë˜ìŠ¤ ì•ˆì—ì„œ í•´ê²°í•´ì•¼ í•œë‹¤.
* `@Autowired`ë¥¼ ì‚¬ìš©í•˜ë©´ ìƒì„±ìì—ì„œ ì—¬ëŸ¬ ì˜ì¡´ê´€ê³„ë„ í•œë²ˆì— ì£¼ì…ë°›ì„ ìˆ˜ ìˆë‹¤.
```java
@Component
public class OrderServiceImpl implements OrderService {
    private final MemberRepository memberRepository;
    private final DiscountPolicy discountPolicy;
    
    @Autowired
    public OrderServiceImpl(MemberRepository memberRepository, DiscountPolicy discountPolicy) {
        this.memberRepository = memberRepository;
        this.discountPolicy = discountPolicy;
    }
}
```

## ğŸ“ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ë™ì‘ ë°©ì‹

* `@ComponentScan`ì€ `@Component`ê°€ ë¶™ì€ ëª¨ë“  í´ë˜ìŠ¤ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•œë‹¤.
* ì´ë•Œ ìŠ¤í”„ë§ ë¹ˆì˜ ê¸°ë³¸ ì´ë¦„ì€ í´ë˜ìŠ¤ëª…ì„ ì‚¬ìš©í•˜ë˜ ë§¨ ì•ê¸€ìë§Œ ì†Œë¬¸ìë¥¼ ì‚¬ìš©í•œë‹¤.
  *  ì´ë¦„ ê¸°ë³¸ ì „ëµ: `RateDiscountPolicy`í´ë˜ìŠ¤ë¥¼ ë“±ë¡í•˜ë©´ `rateDiscountPolicy`ë¹ˆ ì´ë¦„ì´ ë“±ë¡ëœë‹¤.
  *  ì´ë¦„ ì§ì ‘ ì§€ì •: ë§Œì•½ ìŠ¤í”„ë§ ë¹ˆì˜ ì´ë¦„ì„ ì§ì ‘ ì§€ì •í•˜ê³  ì‹¶ìœ¼ë©´ `@Component("rateDiscountPolicy2")`ì´ëŸ°ì‹ìœ¼ë¡œ ì´ë¦„ì„ ë¶€ì—¬í•˜ë©´ ëœë‹¤.

![Image](https://github.com/user-attachments/assets/8250aeca-0f7d-4ec9-8e33-c22ce092dc2d)


## ğŸš€`@Autowired`ì˜ì¡´ê´€ê³„ ìë™ ì£¼ì… ë°©ì‹ 

* ìƒì„±ìì— `@Autowired`ë¥¼ ì§€ì •í•˜ë©´, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ìë™ìœ¼ë¡œ í•´ë‹¹ ìŠ¤í”„ë§ ë¹ˆì„ ì°¾ì•„ì„œ ì£¼ì…í•œë‹¤.
* ì´ë•Œ ê¸°ë³¸ ì¡°íšŒ ì „ë ¥ì€ **íƒ€ì…ì´ ê°™ì€ ë¹ˆ**ì„ ì°¾ì•„ì„œ ì£¼ì…í•œë‹¤. 
  * ğŸš¨`getBean(RateDiscountPolicy.class)` ì™€ ë™ì¼í•˜ë‹¤ê³  ì´í•´í•˜ë©´ ëœë‹¤.ğŸš¨
* ìƒì„±ìì— íŒŒë¼ë¯¸í„°ê°€ ë§ì•„ë„ ë‹¤ ì°¾ì•„ì„œ ìë™ìœ¼ë¡œ ì£¼ì…í•´ì¤€ë‹¤.


## ğŸ‹ì¡°íšŒ ë¹ˆì´ 2ê°œ ì´ìƒì¼ ë•Œ 

* `@Autowired`ëŠ” ì»¨í…Œì´ë„ˆì—ì„œ íƒ€ì…ì´ ê°™ìœ¼ ë¹ˆì„ ì°¾ì•„ì„œ ì£¼ì…ì„ í•´ì¤€ë‹¤.
* ê·¸ëŸ°ë° 10% í• ì¸ `RateDiscountPolicy`í´ë˜ìŠ¤ì™€ ì •ì•¡ í• ì¸ `FixDiscountPolicy`í´ë˜ìŠ¤ ì—ë„ `@Component`ë¥¼ ë“±ë¡í•˜ë©´ ê°™ì€ íƒ€ì…ì˜ ë¹ˆì´ 2ê°œê°€ ë“±ë¡ëœë‹¤. 
* ë™ì¼ íƒ€ì…ì˜ ë¹ˆì´ ì—¬ëŸ¬ ê°œì¼ ê²½ìš° `NoUniqueBeanDefinitionException`ì˜ˆì™¸ê°€ ë°œìƒí•˜ì—¬ ì—ëŸ¬ê°€ ë‚œë‹¤.

> í•´ê²° ë°©ë²• 1
* `@Autowired`ëŠ” íƒ€ì… ë§¤ì¹­ì„ ì‹œë„í•˜ê³ , ì´ë•Œ ì—¬ëŸ¬ ë¹ˆì´ìˆìœ¼ë©´ í•„ë“œ ì´ë¦„, íŒŒë¼ë¯¸í„° ì´ë¦„, ë¹ˆ ì´ë¦„ì„ ì¶”ê°€ ë§¤í•‘í•œë‹¤.
* ì¦‰, 10% í• ì¸ ì •ì±…ì„ ì‚¬ìš©í•˜ë‹ˆ ìƒì„±ì íŒŒë¼ ë¯¸í„° ì´ë¦„ì„ `discountPolicy`ì—ì„œ `rateDiscountPolicy`ë¡œ ìˆ˜ì •í•´ì£¼ë©´ ì •ìƒ ì£¼ì…ì´ ëœë‹¤.

```java
@Component
public class OrderServiceImpl implements OrderService {
    private final MemberRepository memberRepository;
    private final DiscountPolicy discountPolicy;
    
    @Autowired
    public OrderServiceImpl(MemberRepository memberRepository, DiscountPolicy rateDiscountPolicy) {
        this.memberRepository = memberRepository;
        this.discountPolicy = rateDiscountPolicy;
    }
}
```
> í•´ê²° ë°©ë²• 2
* `@Primary`ëŠ” ìš°ì„ ìˆœìœ„ë¥¼ ì •í•˜ëŠ” ë°©ë²•ì´ë‹¤. `@Autowired`ì‹œì— ì—¬ëŸ¬ ë¹ˆì´ ë§¤ì¹­ë˜ë©´ `@Primary`ê°€ ìš°ì„ ê¶Œì„ ê°€ì§„ë‹¤.
* ì¦‰, ìš°ë¦¬ëŠ” 10% í• ì¸ ì •ì±…ì„ ì‚¬ìš©í•˜ë‹ˆ `RateDiscountPolicy`í´ë˜ìŠ¤ì— `@Primary`ì–´ë…¸í…Œì´ì…˜ì„ ì‘ì„±í•˜ì˜€ë‹¤.

```java
@Component
@Primary
public class RateDiscountPolicy implements DiscountPolicy {}

@Component
public class FixDiscountPolicy implements DiscountPolicy {}
```

![Image](https://github.com/user-attachments/assets/8d7fa9e7-a61f-4994-9b59-68401c353528)

## ğŸŒì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ì¢…ë¥˜ 
* `@Component` : ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì—ì„œ ì‚¬ìš©
* `@Controller` : ìŠ¤í”„ë§ MVC ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì‚¬ìš© 
* `@Service` : ìŠ¤í”„ë§ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œ ì‚¬ìš© 
* `@Repository` : ìŠ¤í”„ë§ ë°ì´í„° ì ‘ê·¼ ê³„ì¸µì—ì„œ ì‚¬ìš© 
* `@Configuration` : ìŠ¤í”„ë§ ì„¤ì • ì •ë³´ì—ì„œ ì‚¬ìš©

> `Controller`, `Service`, `Repository`ë“±ë“± ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ëŒ€ìƒì´ ë˜ëŠ” ì´ìœ ëŠ” ì†ŒìŠ¤ ì½”ë“œë¥¼ ë³´ë©´ `@Component`ë¥¼ í¬í•¨ í•˜ê³ ìˆë‹¤.

## ğŸ¥­ì¡°íšŒí•œ ë¹ˆì´ ëª¨ë‘ í•„ìš”í•  ë•Œ

> í´ë¼ì´ì–¸íŠ¸ê°€ í• ì¸ì˜ ì¢…ë¥˜(rate, fix)ë¥¼ ì„ íƒí•  ìˆ˜ ìˆë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ?

* `DiscountService`ëŠ” `Map`ìœ¼ë¡œ ëª¨ë“  `DiscountPolicy`ë¥¼ ì£¼ì…ë°›ëŠ”ë‹¤. `fixDiscountPolicy`, `rateDiscountPolicy`ê°€ ì£¼ì…ëœë‹¤.
* `Map<String, DiscountPolicy>` `map`ì˜ í‚¤ì— ìŠ¤í”„ë§ ë¹ˆì˜ ì´ë¦„ì„ ë„£ì–´ì£¼ê³ , ê·¸ ê°’ìœ¼ë¡œ `DiscountPolicy`íƒ€ì…ìœ¼ë¡œ ì¡°íšŒí•œ ë¹ˆ ê°ì²´ë¥¼ ë‹´ì•„ì¤€ë‹¤.
* `discount()` ë©”ì„œë“œëŠ” íŒŒë¼ë¯¸í„° ê°’ìœ¼ë¡œ `discountCode`ê°€ `fixDiscountPolicy`ê°€ ë„˜ì–´ì˜¤ë©´ `fixDiscountPolicy` ìŠ¤í”„ë§ ë¹ˆì„ ì°¾ì•„ì„œ ì‹¤í–‰í•œë‹¤.

```java
public class AllBeanTest {

    @Test
    void findAllBean() {
        ApplicationContext ac = new AnnotationConfigApplicationContext(AutoAppConfig.class, DiscountService.class);
        DiscountService discountService = ac.getBean(DiscountService.class);

        Member member = new Member(1L, "userA", Grade.VIP);
        int discountPrice = discountService.discount(member, 10000, "fixDiscountPolicy");

        assertThat(discountService).isInstanceOf(DiscountService.class);
        assertThat(discountPrice).isEqualTo(1000);

        int rateDiscountPrice = discountService.discount(member, 20000, "rateDiscountPolicy");
        assertThat(rateDiscountPrice).isEqualTo(2000);
    }

    static class DiscountService {
        private final Map<String, DiscountPolicy> policyMap;
        private final List<DiscountPolicy> policies;

        public DiscountService(Map<String, DiscountPolicy> policyMap, List<DiscountPolicy> policies) {
            this.policyMap = policyMap;
            this.policies = policies;
            System.out.println("policyMap = " + policyMap);
            // policyMap = {fixDiscountPolicy=hello.core.discount.FixDiscountPolicy@db44aa2, rateDiscountPolicy=hello.core.discount.RateDiscountPolicy@2de366bb}
            
          System.out.println("policies = " + policies);
            // policies = [hello.core.discount.FixDiscountPolicy@db44aa2, hello.core.discount.RateDiscountPolicy@2de366bb]
        }

        public int discount(Member member, int price, String discountCode) {
            DiscountPolicy discountPolicy = policyMap.get(discountCode);
            return discountPolicy.discount(member, price);
        }
    }

}
```

